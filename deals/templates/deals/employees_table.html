{% extends 'deals/base.html' %}
{% load static %}

{% block title %}Таблица сотрудников - Управление сделками{% endblock %}

{% block extra_js %}
    <script src="https://api.bitrix24.com/api/v1/"></script>
    <script src="{% static 'js/employees_table.js' %}"></script>
{% endblock %}

{% block content %}
<h1>Таблица сотрудников</h1>

<div class="controls">
    <button id="generate-test-calls" class="btn btn-primary">
        Сгенерировать тестовые звонки
    </button>
    <span id="generate-status" style="margin-left: 10px;"></span>
</div>

<div class="table-container">
    <table class="employees-table">
        <thead>
            <tr>
                <th>Сотрудник</th>
                <th>Должность</th>
                <th>Руководители</th>
                <th>Звонков (24ч)</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
            <tr>
                <td>
                    <a href="#" class="employee-link" data-user-id="{{ employee.id }}">
                        {{ employee.name }}
                    </a>
                </td>
                <td>{{ employee.position|default:"Не указана" }}</td>
                <td>
                    {% if employee.managers %}
                        {% for manager in employee.managers %}
                            <a href="#" class="manager-link" data-user-id="{{ manager.id }}">
                                {{ manager.name }}{% if not forloop.last %}, {% endif %}
                            </a>
                        {% endfor %}
                    {% else %}
                        <span class="no-managers">Нет руководителей</span>
                    {% endif %}
                </td>
                <td class="call-count">{{ employee.call_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
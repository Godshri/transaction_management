{% extends "deals/base.html" %}
{% load static %}

{% block title %}Импорт/Экспорт контактов - Управление сделками{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/contacts_import_export.css' %}">
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/contacts_import_export.js' %}"></script>
{% endblock %}

{% block content %}
<div class="container">
    <h2>Импорт/Экспорт контактов</h2>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('import')">Импорт</button>
        <button class="tab-btn" onclick="openTab('export')">Экспорт</button>
        <button class="tab-btn" onclick="openTab('history')">История</button>
    </div>

    <div id="import" class="tab-content active">
        <h3>Импорт контактов</h3>
        <form id="importForm" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label>Формат файла:</label>
                <select name="format" required>
                    <option value="csv">CSV</option>
                    <option value="xlsx">XLSX</option>
                </select>
            </div>

            <div class="form-group">
                <label>Файл с контактами:</label>
                <input type="file" name="file" accept=".csv,.xlsx" required>
                <small>Формат: имя,фамилия,номер телефона,почта,компания</small>
            </div>

            <button type="submit" class="btn btn-primary">Начать импорт</button>
        </form>

        <div id="importProgress" style="display: none; margin-top: 20px;">
            <h4>Прогресс импорта</h4>
            <div class="progress">
                <div class="progress-bar" style="width: 0%"></div>
            </div>
            <p id="importStatus"></p>
        </div>
    </div>

    <div id="export" class="tab-content">
        <h3>Экспорт контактов</h3>
        <form id="exportForm">
            {% csrf_token %}
            <div class="form-group">
                <label>Формат файла:</label>
                <select name="format" required>
                    <option value="csv">CSV</option>
                    <option value="xlsx">XLSX</option>
                </select>
            </div>

            <div class="form-group">
                <label>Фильтр по дате:</label>
                <select name="date_filter">
                    <option value="all">Все контакты</option>
                    <option value="today">Сегодня</option>
                    <option value="yesterday">Вчера</option>
                    <option value="last_week">За последнюю неделю</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Начать экспорт</button>
        </form>

        <div id="exportProgress" style="display: none; margin-top: 20px;">
            <h4>Прогресс экспорта</h4>
            <div class="progress">
                <div class="progress-bar" style="width: 0%"></div>
            </div>
            <p id="exportStatus"></p>
        </div>
    </div>

    <div id="history" class="tab-content">
        <h3>История операций</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Тип</th>
                    <th>Формат</th>
                    <th>Статус</th>
                    <th>Записей</th>
                    <th>Дата</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="historyTable">
            </tbody>
        </table>
    </div>
</div>
{% endblock %}